{"ast":null,"code":"import _regeneratorRuntime from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState}from\"react\";import icon from\"../src/img/photo.png\";import{Link,useNavigate}from\"react-router-dom\";import{AuthContext}from\"./context/AuthContext\";import{getDownloadURL,ref,uploadBytesResumable}from\"firebase/storage\";import{auth,db,storage}from\"./firebase\";import{v4 as uuid}from\"uuid\";import{doc,updateDoc}from\"firebase/firestore\";import{updateProfile,updateCurrentUser}from\"firebase/auth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Settings=function Settings(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),err=_useState2[0],setErr=_useState2[1];var navigate=useNavigate();var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),text=_useState4[0],setText=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),img=_useState6[0],setImg=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),blank=_useState8[0],setBlank=_useState8[1];var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e){var displayName,storageRef,uploadTask,_storageRef,_uploadTask;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:e.preventDefault();displayName=e.target[0].value;console.log(currentUser.uid);_context3.prev=3;if(!(img&&text!==\"\")){_context3.next=12;break;}setBlank(false);storageRef=ref(storage,uuid());uploadTask=uploadBytesResumable(storageRef,img);uploadTask.on(function(error){},function(){getDownloadURL(uploadTask.snapshot.ref).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(downloadURL){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return updateDoc(doc(db,\"users\",currentUser.uid),{displayName:displayName,photoURL:downloadURL});case 2:_context.next=4;return updateProfile(currentUser,{displayName:displayName,photoURL:downloadURL});case 4:case\"end\":return _context.stop();}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}());});navigate(\"/\");_context3.next=22;break;case 12:if(!(img===null&&text!==\"\")){_context3.next=21;break;}setBlank(false);_context3.next=16;return updateDoc(doc(db,\"users\",currentUser.uid),{displayName:displayName});case 16:_context3.next=18;return updateProfile(currentUser,{displayName:displayName});case 18:navigate(\"/\");_context3.next=22;break;case 21:if(img&&text===\"\"){setBlank(false);_storageRef=ref(storage,uuid());_uploadTask=uploadBytesResumable(_storageRef,img);_uploadTask.on(function(error){},function(){getDownloadURL(_uploadTask.snapshot.ref).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(downloadURL){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return updateDoc(doc(db,\"users\",currentUser.uid),{photoURL:downloadURL});case 2:_context2.next=4;return updateProfile(currentUser,{photoURL:downloadURL});case 4:case\"end\":return _context2.stop();}},_callee2);}));return function(_x3){return _ref3.apply(this,arguments);};}());});}else{setBlank(true);}case 22:setText(\"\");setImg(null);_context3.next=29;break;case 26:_context3.prev=26;_context3.t0=_context3[\"catch\"](3);setErr(true);case 29:console.log(currentUser);case 30:case\"end\":return _context3.stop();}},_callee3,null,[[3,26]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"formContainer\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"formWrapper\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"logo\",children:\"Settings\"}),/*#__PURE__*/_jsx(\"span\",{className:\"title\",children:\"Update Profile\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"New display name\",onChange:function onChange(e){return setText(e.target.value);},value:text}),/*#__PURE__*/_jsx(\"input\",{style:{display:\"none\"},type:\"file\",id:\"file\",onChange:function onChange(e){return setImg(e.target.files[0]);}}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"file\",placeholder:\"https://cdn-icons-png.flaticon.com/512/456/456212.png\",children:[/*#__PURE__*/_jsx(\"img\",{src:icon,alt:\"\"}),/*#__PURE__*/_jsx(\"span\",{children:\"New avatar\"})]}),/*#__PURE__*/_jsx(\"button\",{children:\"Save Changes\"}),err&&/*#__PURE__*/_jsx(\"span\",{children:\"Something went wrong\"}),blank&&/*#__PURE__*/_jsx(\"span\",{children:\"No changes have been made!\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Don't want to make any changes? \",/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"Return Home\"})]})]})});};export default Settings;","map":{"version":3,"names":["React","useContext","useState","icon","Link","useNavigate","AuthContext","getDownloadURL","ref","uploadBytesResumable","auth","db","storage","v4","uuid","doc","updateDoc","updateProfile","updateCurrentUser","jsx","_jsx","jsxs","_jsxs","Settings","_useState","_useState2","_slicedToArray","err","setErr","navigate","_useContext","currentUser","_useState3","_useState4","text","setText","_useState5","_useState6","img","setImg","_useState7","_useState8","blank","setBlank","handleSubmit","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee3","e","displayName","storageRef","uploadTask","_storageRef","_uploadTask","wrap","_callee3$","_context3","prev","next","preventDefault","target","value","console","log","uid","on","error","snapshot","then","_ref2","_callee","downloadURL","_callee$","_context","photoURL","stop","_x2","apply","arguments","_ref3","_callee2","_callee2$","_context2","_x3","t0","_x","className","children","onSubmit","type","placeholder","onChange","style","display","id","files","htmlFor","src","alt","to"],"sources":["/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/src/Settings.jsx"],"sourcesContent":["import React, { useContext, useState } from \"react\";\nimport icon from \"../src/img/photo.png\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { AuthContext } from \"./context/AuthContext\";\nimport { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\";\nimport { auth, db, storage } from \"./firebase\";\nimport { v4 as uuid } from \"uuid\"\nimport { doc, updateDoc } from \"firebase/firestore\";\nimport { updateProfile, updateCurrentUser } from \"firebase/auth\";\n\nconst Settings = () => {\n    const [err, setErr] = useState(false);\n    const navigate = useNavigate();\n    const {currentUser} = useContext(AuthContext);\n    const [ text, setText ] = useState(\"\");\n    const [ img, setImg ] = useState(null);\n    const [ blank, setBlank ] = useState(false);\n\n    const handleSubmit = async (e) => {\n      e.preventDefault();\n      const displayName = e.target[0].value;\n\n      console.log(currentUser.uid);\n\n      try{\n        if(img && text !== \"\"){\n        setBlank(false);\n        const storageRef = ref(storage,  uuid());\n\n        const uploadTask = uploadBytesResumable(storageRef, img);\n\n        uploadTask.on(\n            (error) => {\n\n            },\n            () => {\n                getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n                    await updateDoc(doc(db, \"users\", currentUser.uid),{\n                        displayName,\n                        photoURL: downloadURL,\n                    })\n                    await updateProfile(currentUser, {\n                        displayName,\n                        photoURL: downloadURL,\n                    })\n                })\n            }\n        )\n        navigate(\"/\");\n      }\n      else if(img === null && text !== \"\"){\n        setBlank(false);\n        await updateDoc(doc(db, \"users\", currentUser.uid), {\n            displayName,\n        })\n        await updateProfile(currentUser, {\n            displayName,\n        })\n        navigate(\"/\");\n      }\n      else if(img && text === \"\")\n      {\n        setBlank(false);\n        const storageRef = ref(storage, uuid());\n        const uploadTask = uploadBytesResumable(storageRef, img);\n\n        uploadTask.on(\n            (error) => {\n\n            },\n            () => {\n                getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n                    await updateDoc(doc(db, \"users\", currentUser.uid),{\n                        photoURL: downloadURL,\n                    })\n                    await updateProfile(currentUser, {\n                        photoURL: downloadURL,\n                    })\n                })\n            }\n        )\n      }\n      else{\n        setBlank(true);\n      }\n\n      setText(\"\");\n      setImg(null);\n    }\n    catch(err){\n        setErr(true);\n    }\n    console.log(currentUser);\n  };\n    return(\n        <div className=\"formContainer\">\n\n            <div className=\"formWrapper\">\n                <span className=\"logo\">Settings</span>\n                <span className=\"title\">Update Profile</span>\n                <form onSubmit={handleSubmit}>\n                    <input type=\"text\" placeholder=\"New display name\" onChange={e=>setText(e.target.value)} value={text}/>\n                    <input style={{display: \"none\"}} type=\"file\" id=\"file\" onChange={e=>setImg(e.target.files[0])}/>\n                    <label htmlFor=\"file\" placeholder=\"https://cdn-icons-png.flaticon.com/512/456/456212.png\">\n                        <img src={icon} alt=\"\" />\n                        <span>New avatar</span>\n                    </label>\n                    <button>Save Changes</button>\n                    {err && <span>Something went wrong</span>}\n                    {blank && <span>No changes have been made!</span>}\n                </form>\n                <p>Don't want to make any changes? <Link to=\"/\">Return Home</Link></p>\n            </div>\n        </div>\n    )\n}\n\nexport default Settings"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}