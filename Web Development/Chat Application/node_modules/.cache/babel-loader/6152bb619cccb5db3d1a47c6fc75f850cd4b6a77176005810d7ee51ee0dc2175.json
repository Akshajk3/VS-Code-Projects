{"ast":null,"code":"import _defineProperty from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState}from\"react\";import{collection,query,where,getDocs,setDoc,doc,updateDoc,serverTimestamp,getDoc}from\"firebase/firestore\";import{db}from\"../firebase\";import{AuthContext}from\"../context/AuthContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Search=function Search(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),err=_useState6[0],setErr=_useState6[1];var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var handleSearch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var q,querySnapshot;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:q=query(collection(db,\"users\"),where(\"displayName\",\"==\",username));_context.prev=1;_context.next=4;return getDocs(q);case 4:querySnapshot=_context.sent;querySnapshot.forEach(function(doc){setUser(doc.data());});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);setErr(true);case 11:case\"end\":return _context.stop();}},_callee,null,[[1,8]]);}));return function handleSearch(){return _ref.apply(this,arguments);};}();var handleKey=function handleKey(e){if(username!==\"\"){e.code===\"Enter\"&&handleSearch();}else{document.getElementById(\"element\").style.display=\"none\";}};var handleSelect=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var combinedId,res,_updateDoc,_updateDoc2;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0://check whether the group(chats in firestore) exists, if not create\ncombinedId=currentUser.uid>user.uid?currentUser.uid+user.uid:user.uid+currentUser.uid;_context2.prev=1;_context2.next=4;return getDoc(doc(db,\"chats\",combinedId));case 4:res=_context2.sent;if(res.exists()){_context2.next=12;break;}_context2.next=8;return setDoc(doc(db,\"chats\",combinedId),{messages:[]});case 8:_context2.next=10;return updateDoc(doc(db,\"userChats\",currentUser.uid),(_updateDoc={},_defineProperty(_updateDoc,combinedId+\".userInfo\",{uid:user.uid,displayName:user.displayName,photoURL:user.photoURL}),_defineProperty(_updateDoc,combinedId+\".date\",serverTimestamp()),_updateDoc));case 10:_context2.next=12;return updateDoc(doc(db,\"userChats\",user.uid),(_updateDoc2={},_defineProperty(_updateDoc2,combinedId+\".userInfo\",{uid:currentUser.uid,displayName:currentUser.displayName,photoURL:currentUser.photoURL}),_defineProperty(_updateDoc2,combinedId+\".date\",serverTimestamp()),_updateDoc2));case 12:_context2.next=16;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](1);case 16:case\"end\":return _context2.stop();}},_callee2,null,[[1,14]]);}));return function handleSelect(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"search\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"searchForm\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Find a user\",onKeyDown:handleKey,onChange:function onChange(e){return setUsername(e.target.value);},value:username})}),err&&/*#__PURE__*/_jsx(\"span\",{children:\"User not found\"}),user&&/*#__PURE__*/_jsxs(\"div\",{className:\"userChat\",onClick:handleSelect,children:[/*#__PURE__*/_jsx(\"img\",{src:user.photoURL,alt:\"\"}),/*#__PURE__*/_jsx(\"div\",{className:\"userChatInfo\",children:/*#__PURE__*/_jsx(\"span\",{children:user.displayName})})]})]});};export default Search;","map":{"version":3,"names":["React","useContext","useState","collection","query","where","getDocs","setDoc","doc","updateDoc","serverTimestamp","getDoc","db","AuthContext","jsx","_jsx","jsxs","_jsxs","Search","_useState","_useState2","_slicedToArray","username","setUsername","_useState3","_useState4","user","setUser","_useState5","_useState6","err","setErr","_useContext","currentUser","handleSearch","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","q","querySnapshot","wrap","_callee$","_context","prev","next","sent","forEach","data","t0","stop","apply","arguments","handleKey","e","code","document","getElementById","style","display","handleSelect","_ref2","_callee2","combinedId","res","_updateDoc","_updateDoc2","_callee2$","_context2","uid","exists","messages","_defineProperty","displayName","photoURL","className","children","type","placeholder","onKeyDown","onChange","target","value","onClick","src","alt"],"sources":["/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/src/components/Search.jsx"],"sourcesContent":["import React, { useContext, useState } from \"react\";\nimport { collection, query, where, getDocs, setDoc, doc, updateDoc, serverTimestamp, getDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport { AuthContext } from \"../context/AuthContext\";\n\nconst Search = () => {\n    const [username, setUsername] = useState(\"\");\n    const [user, setUser] = useState(null);\n    const [err, setErr] = useState(false);\n\n    const {currentUser} = useContext(AuthContext);\n\n    const handleSearch = async () =>{\n        const q = query(collection(db, \"users\"), where(\"displayName\", \"==\", username));\n\n        try{\n            const querySnapshot = await getDocs(q);\n            querySnapshot.forEach((doc) => {\n                setUser(doc.data())\n            });\n        }catch(err){\n            setErr(true);\n        }\n    };\n\n    const handleKey = (e) =>{\n        if(username !== \"\")\n        {\n            e.code === \"Enter\" && handleSearch();\n        }\n        else\n        {\n            document.getElementById(\"element\").style.display = \"none\";\n        }\n    };\n\n    const handleSelect = async () =>{\n        //check whether the group(chats in firestore) exists, if not create\n        const combinedId = currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n\n        try{\n            const res = await getDoc(doc(db, \"chats\", combinedId));\n\n            if(!res.exists()){\n                //create a chat in chats collection\n                await setDoc(doc(db, \"chats\", combinedId), {messages: []});\n\n                //create user chats\n                await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n                    [combinedId+\".userInfo\"]:{\n                        uid:user.uid,\n                        displayName: user.displayName,\n                        photoURL: user.photoURL\n                    },\n                    [combinedId+\".date\"]: serverTimestamp()\n                });\n\n                await updateDoc(doc(db, \"userChats\", user.uid), {\n                    [combinedId+\".userInfo\"]:{\n                        uid:currentUser.uid,\n                        displayName: currentUser.displayName,\n                        photoURL: currentUser.photoURL\n                    },\n                    [combinedId+\".date\"]: serverTimestamp()\n                });\n            }\n        }catch(err){\n\n        }\n\n        //create user chats\n    };\n\n    return (\n        <div className=\"search\">\n            <div className=\"searchForm\">\n                <input type=\"text\" placeholder=\"Find a user\" onKeyDown={handleKey} onChange={(e)=>setUsername(e.target.value)} value={username}/>\n            </div>\n                {err && <span>User not found</span>}\n                {user && (\n                <div className=\"userChat\" onClick={handleSelect}>\n                    <img src={user.photoURL} alt=\"\" />\n                    <div className=\"userChatInfo\">\n                        <span>{user.displayName}</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport default Search"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}