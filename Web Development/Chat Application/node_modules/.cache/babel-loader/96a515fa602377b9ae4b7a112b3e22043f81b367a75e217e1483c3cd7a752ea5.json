{"ast":null,"code":"import _defineProperty from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{async}from\"@firebase/util\";import{arrayUnion,doc,serverTimestamp,setDoc,updateDoc}from\"firebase/firestore\";import React,{useContext,useDebugValue,useState}from\"react\";import{AuthContext}from\"../context/AuthContext\";import{ChatContext}from\"../context/ChatContext\";import Img from\"./img/image.png\";import Attach from\"./img/paper-clip.png\";import{v4 as uuid}from\"uuid\";import{Timestamp}from\"firebase/firestore\";import{db,storage}from\"../firebase\";import{getDownloadURL,ref,uploadBytesResumable}from\"firebase/storage\";import{updateProfile}from\"firebase/auth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Input=function Input(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),img=_useState4[0],setImg=_useState4[1];var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useContext2=useContext(ChatContext),data=_useContext2.data;var handleSend=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _updateDoc,_updateDoc2;var storageRef,uploadTask;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!img){_context2.next=6;break;}storageRef=ref(storage,uuid());uploadTask=uploadBytesResumable(storageRef,img);uploadTask.on(function(error){},function(){getDownloadURL(uploadTask.snapshot.ref).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(downloadURL){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return updateDoc(doc(db,\"chats\",data.chatId),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now(),img:downloadURL})});case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());});_context2.next=8;break;case 6:_context2.next=8;return updateDoc(doc(db,\"chats\",data.chatId),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now()})});case 8:_context2.next=10;return updateDoc(doc(db,\"userChats\",currentUser.uid),(_updateDoc={},_defineProperty(_updateDoc,data.chatId+\".lastMessage\",{text:text}),_defineProperty(_updateDoc,data.chatId+\".date\",serverTimestamp()),_updateDoc));case 10:_context2.next=12;return updateDoc(doc(db,\"userChats\",data.user.uid),(_updateDoc2={},_defineProperty(_updateDoc2,data.chatId+\".lastMessage\",{text:text}),_defineProperty(_updateDoc2,data.chatId+\".date\",serverTimestamp()),_updateDoc2));case 12:setText(\"\");setImg(null);case 14:case\"end\":return _context2.stop();}},_callee2);}));return function handleSend(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type something...\",onChange:function onChange(e){return setText(e.target.value);},value:text}),/*#__PURE__*/_jsxs(\"div\",{className:\"send\",children:[/*#__PURE__*/_jsx(\"img\",{src:Attach,alt:\"\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:\"none\"},id:\"file\",onChange:function onChange(e){return setImg(e.target.files[0]);}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file\",children:/*#__PURE__*/_jsx(\"img\",{src:Img,alt:\"\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,children:\"Send\"})]})]});};export default Input;","map":{"version":3,"names":["async","arrayUnion","doc","serverTimestamp","setDoc","updateDoc","React","useContext","useDebugValue","useState","AuthContext","ChatContext","Img","Attach","v4","uuid","Timestamp","db","storage","getDownloadURL","ref","uploadBytesResumable","updateProfile","jsx","_jsx","jsxs","_jsxs","Input","_useState","_useState2","_slicedToArray","text","setText","_useState3","_useState4","img","setImg","_useContext","currentUser","_useContext2","data","handleSend","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","_updateDoc","_updateDoc2","storageRef","uploadTask","wrap","_callee2$","_context2","prev","next","on","error","snapshot","then","_ref2","_callee","downloadURL","_callee$","_context","chatId","messages","id","senderId","uid","date","now","stop","_x","apply","arguments","_defineProperty","user","className","children","type","placeholder","onChange","e","target","value","src","alt","style","display","files","htmlFor","onClick"],"sources":["/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/src/components/Input.jsx"],"sourcesContent":["import { async } from \"@firebase/util\";\nimport { arrayUnion, doc, serverTimestamp, setDoc, updateDoc } from \"firebase/firestore\";\nimport React, { useContext, useDebugValue, useState } from \"react\";\nimport { AuthContext } from \"../context/AuthContext\";\nimport { ChatContext } from \"../context/ChatContext\";\nimport Img from \"./img/image.png\"\nimport Attach from \"./img/paper-clip.png\"\nimport { v4 as uuid } from \"uuid\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { db, storage } from \"../firebase\";\nimport { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\";\nimport { updateProfile } from \"firebase/auth\";\n\nconst Input = () => {\n    const [ text, setText] = useState(\"\");\n    const [ img, setImg] = useState(null);\n\n    const {currentUser} = useContext(AuthContext);\n    const {data} = useContext(ChatContext);\n    \n    const handleSend = async () => {\n         \n        if(img){\n            const storageRef = ref(storage, uuid());\n\n            const uploadTask = uploadBytesResumable(storageRef, img);\n\n            uploadTask.on(\n                (error) => {\n                    \n                },\n                () => {\n                    getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n                        await updateDoc(doc(db, \"chats\", data.chatId), {\n                            messages: arrayUnion({\n                                id: uuid(),\n                                text,\n                                senderId: currentUser.uid,\n                                date: Timestamp.now(),\n                                img: downloadURL\n                            }),\n                        });\n                    })\n                }\n            )\n        }\n        else{\n            await updateDoc(doc(db, \"chats\", data.chatId), {\n                messages: arrayUnion({\n                    id: uuid(),\n                    text,\n                    senderId: currentUser.uid,\n                    date: Timestamp.now(),\n                }),\n            });\n        }\n\n        await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n            [data.chatId + \".lastMessage\"]:{\n                text\n            },\n            [data.chatId + \".date\"]:serverTimestamp()\n        });\n\n        await updateDoc(doc(db, \"userChats\", data.user.uid), {\n            [data.chatId + \".lastMessage\"]:{\n                text\n            },\n            [data.chatId + \".date\"]:serverTimestamp()\n        });\n\n        setText(\"\");\n        setImg(null);\n    };\n    \n    return (\n        <div className=\"input\">\n            <input type=\"text\" placeholder=\"Type something...\" onChange={e=>setText(e.target.value)} value={text}/>\n            <div className=\"send\">\n                <img src={Attach} alt=\"\" />\n                <input type=\"file\" style={{display:\"none\"}} id=\"file\" onChange={e=>setImg(e.target.files[0])}/>\n                <label htmlFor=\"file\">\n                    <img src={Img} alt=\"\" />\n                </label>\n                <button onClick={handleSend}>Send</button>\n            </div>\n        </div>\n    )\n}\n\nexport default Input"],"mappings":"8pBAAA,OAASA,KAAK,KAAQ,gBAAgB,CACtC,OAASC,UAAU,CAAEC,GAAG,CAAEC,eAAe,CAAEC,MAAM,CAAEC,SAAS,KAAQ,oBAAoB,CACxF,MAAO,CAAAC,KAAK,EAAIC,UAAU,CAAEC,aAAa,CAAEC,QAAQ,KAAQ,OAAO,CAClE,OAASC,WAAW,KAAQ,wBAAwB,CACpD,OAASC,WAAW,KAAQ,wBAAwB,CACpD,MAAO,CAAAC,GAAG,KAAM,iBAAiB,CACjC,MAAO,CAAAC,MAAM,KAAM,sBAAsB,CACzC,OAASC,EAAE,GAAI,CAAAC,IAAI,KAAQ,MAAM,CACjC,OAASC,SAAS,KAAQ,oBAAoB,CAC9C,OAASC,EAAE,CAAEC,OAAO,KAAQ,aAAa,CACzC,OAASC,cAAc,CAAEC,GAAG,CAAEC,oBAAoB,KAAQ,kBAAkB,CAC5E,OAASC,aAAa,KAAQ,eAAe,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAE9C,GAAM,CAAAC,KAAK,CAAG,QAAR,CAAAA,KAAKA,CAAA,CAAS,CAChB,IAAAC,SAAA,CAAyBnB,QAAQ,CAAC,EAAE,CAAC,CAAAoB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA7BG,IAAI,CAAAF,UAAA,IAAEG,OAAO,CAAAH,UAAA,IACrB,IAAAI,UAAA,CAAuBxB,QAAQ,CAAC,IAAI,CAAC,CAAAyB,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAA7BE,GAAG,CAAAD,UAAA,IAAEE,MAAM,CAAAF,UAAA,IAEnB,IAAAG,WAAA,CAAsB9B,UAAU,CAACG,WAAW,CAAC,CAAtC4B,WAAW,CAAAD,WAAA,CAAXC,WAAW,CAClB,IAAAC,YAAA,CAAehC,UAAU,CAACI,WAAW,CAAC,CAA/B6B,IAAI,CAAAD,YAAA,CAAJC,IAAI,CAEX,GAAM,CAAAC,UAAU,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,SAAA,MAAAC,UAAA,CAAAC,WAAA,KAAAC,UAAA,CAAAC,UAAA,QAAAN,mBAAA,GAAAO,IAAA,UAAAC,UAAAC,SAAA,iBAAAA,SAAA,CAAAC,IAAA,CAAAD,SAAA,CAAAE,IAAA,aAEZpB,GAAG,EAAAkB,SAAA,CAAAE,IAAA,UACIN,UAAU,CAAG7B,GAAG,CAACF,OAAO,CAAEH,IAAI,EAAE,CAAC,CAEjCmC,UAAU,CAAG7B,oBAAoB,CAAC4B,UAAU,CAAEd,GAAG,CAAC,CAExDe,UAAU,CAACM,EAAE,CACT,SAACC,KAAK,CAAK,CAEX,CAAC,CACD,UAAM,CACFtC,cAAc,CAAC+B,UAAU,CAACQ,QAAQ,CAACtC,GAAG,CAAC,CAACuC,IAAI,6BAAAC,KAAA,CAAAjB,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAgB,QAAOC,WAAW,SAAAlB,mBAAA,GAAAO,IAAA,UAAAY,SAAAC,QAAA,iBAAAA,QAAA,CAAAV,IAAA,CAAAU,QAAA,CAAAT,IAAA,SAAAS,QAAA,CAAAT,IAAA,SACrD,CAAAlD,SAAS,CAACH,GAAG,CAACe,EAAE,CAAE,OAAO,CAAEuB,IAAI,CAACyB,MAAM,CAAC,CAAE,CAC3CC,QAAQ,CAAEjE,UAAU,CAAC,CACjBkE,EAAE,CAAEpD,IAAI,EAAE,CACVgB,IAAI,CAAJA,IAAI,CACJqC,QAAQ,CAAE9B,WAAW,CAAC+B,GAAG,CACzBC,IAAI,CAAEtD,SAAS,CAACuD,GAAG,EAAE,CACrBpC,GAAG,CAAE2B,WACT,CAAC,CACL,CAAC,CAAC,yBAAAE,QAAA,CAAAQ,IAAA,MAAAX,OAAA,GACL,mBAAAY,EAAA,SAAAb,KAAA,CAAAc,KAAA,MAAAC,SAAA,QAAC,CACN,CAAC,CACJ,CAAAtB,SAAA,CAAAE,IAAA,gBAAAF,SAAA,CAAAE,IAAA,SAGK,CAAAlD,SAAS,CAACH,GAAG,CAACe,EAAE,CAAE,OAAO,CAAEuB,IAAI,CAACyB,MAAM,CAAC,CAAE,CAC3CC,QAAQ,CAAEjE,UAAU,CAAC,CACjBkE,EAAE,CAAEpD,IAAI,EAAE,CACVgB,IAAI,CAAJA,IAAI,CACJqC,QAAQ,CAAE9B,WAAW,CAAC+B,GAAG,CACzBC,IAAI,CAAEtD,SAAS,CAACuD,GAAG,EACvB,CAAC,CACL,CAAC,CAAC,QAAAlB,SAAA,CAAAE,IAAA,UAGA,CAAAlD,SAAS,CAACH,GAAG,CAACe,EAAE,CAAE,WAAW,CAAEqB,WAAW,CAAC+B,GAAG,CAAC,EAAAtB,UAAA,IAAA6B,eAAA,CAAA7B,UAAA,CAChDP,IAAI,CAACyB,MAAM,CAAG,cAAc,CAAE,CAC3BlC,IAAI,CAAJA,IACJ,CAAC,EAAA6C,eAAA,CAAA7B,UAAA,CACAP,IAAI,CAACyB,MAAM,CAAG,OAAO,CAAE9D,eAAe,EAAE,EAAA4C,UAAA,EAC3C,SAAAM,SAAA,CAAAE,IAAA,UAEI,CAAAlD,SAAS,CAACH,GAAG,CAACe,EAAE,CAAE,WAAW,CAAEuB,IAAI,CAACqC,IAAI,CAACR,GAAG,CAAC,EAAArB,WAAA,IAAA4B,eAAA,CAAA5B,WAAA,CAC9CR,IAAI,CAACyB,MAAM,CAAG,cAAc,CAAE,CAC3BlC,IAAI,CAAJA,IACJ,CAAC,EAAA6C,eAAA,CAAA5B,WAAA,CACAR,IAAI,CAACyB,MAAM,CAAG,OAAO,CAAE9D,eAAe,EAAE,EAAA6C,WAAA,EAC3C,SAEFhB,OAAO,CAAC,EAAE,CAAC,CACXI,MAAM,CAAC,IAAI,CAAC,CAAC,yBAAAiB,SAAA,CAAAmB,IAAA,MAAA1B,QAAA,GAChB,kBArDK,CAAAL,UAAUA,CAAA,SAAAC,IAAA,CAAAgC,KAAA,MAAAC,SAAA,OAqDf,CAED,mBACIjD,KAAA,QAAKoD,SAAS,CAAC,OAAO,CAAAC,QAAA,eAClBvD,IAAA,UAAOwD,IAAI,CAAC,MAAM,CAACC,WAAW,CAAC,mBAAmB,CAACC,QAAQ,CAAE,SAAAA,SAAAC,CAAC,QAAE,CAAAnD,OAAO,CAACmD,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,EAAC,CAACA,KAAK,CAAEtD,IAAK,EAAE,cACvGL,KAAA,QAAKoD,SAAS,CAAC,MAAM,CAAAC,QAAA,eACjBvD,IAAA,QAAK8D,GAAG,CAAEzE,MAAO,CAAC0E,GAAG,CAAC,EAAE,EAAG,cAC3B/D,IAAA,UAAOwD,IAAI,CAAC,MAAM,CAACQ,KAAK,CAAE,CAACC,OAAO,CAAC,MAAM,CAAE,CAACtB,EAAE,CAAC,MAAM,CAACe,QAAQ,CAAE,SAAAA,SAAAC,CAAC,QAAE,CAAA/C,MAAM,CAAC+C,CAAC,CAACC,MAAM,CAACM,KAAK,CAAC,CAAC,CAAC,CAAC,EAAC,EAAE,cAC/FlE,IAAA,UAAOmE,OAAO,CAAC,MAAM,CAAAZ,QAAA,cACjBvD,IAAA,QAAK8D,GAAG,CAAE1E,GAAI,CAAC2E,GAAG,CAAC,EAAE,EAAG,EACpB,cACR/D,IAAA,WAAQoE,OAAO,CAAEnD,UAAW,CAAAsC,QAAA,CAAC,MAAI,EAAS,GACxC,GACJ,CAEd,CAAC,CAED,cAAe,CAAApD,KAAK"},"metadata":{},"sourceType":"module","externalDependencies":[]}