{"ast":null,"code":"import _defineProperty from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{arrayUnion,doc,serverTimestamp,updateDoc}from\"firebase/firestore\";import React,{useContext,useState}from\"react\";import{AuthContext}from\"../context/AuthContext\";import{ChatContext}from\"../context/ChatContext\";import Img from\"./img/image.png\";import Attach from\"./img/paper-clip.png\";import{v4 as uuid}from\"uuid\";import{Timestamp}from\"firebase/firestore\";import{db,storage}from\"../firebase\";import{getDownloadURL,ref,uploadBytesResumable}from\"firebase/storage\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Input=function Input(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),img=_useState4[0],setImg=_useState4[1];var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useContext2=useContext(ChatContext),data=_useContext2.data;var handleSend=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _updateDoc,_updateDoc2;var storageRef,uploadTask;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!(img&&text!==\"\")){_context2.next=6;break;}storageRef=ref(storage,uuid());uploadTask=uploadBytesResumable(storageRef,img);uploadTask.on(function(error){},function(){getDownloadURL(uploadTask.snapshot.ref).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(downloadURL){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return updateDoc(doc(db,\"chats\",data.chatId),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now(),img:downloadURL})});case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());});_context2.next=9;break;case 6:if(!(text!==\"\")){_context2.next=9;break;}_context2.next=9;return updateDoc(doc(db,\"chats\",data.chatId),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now()})});case 9:_context2.next=11;return updateDoc(doc(db,\"userChats\",currentUser.uid),(_updateDoc={},_defineProperty(_updateDoc,data.chatId+\".lastMessage\",{text:text}),_defineProperty(_updateDoc,data.chatId+\".date\",serverTimestamp()),_updateDoc));case 11:_context2.next=13;return updateDoc(doc(db,\"userChats\",data.user.uid),(_updateDoc2={},_defineProperty(_updateDoc2,data.chatId+\".lastMessage\",{text:text}),_defineProperty(_updateDoc2,data.chatId+\".date\",serverTimestamp()),_updateDoc2));case 13:setText(\"\");setImg(null);case 15:case\"end\":return _context2.stop();}},_callee2);}));return function handleSend(){return _ref.apply(this,arguments);};}();var handleKey=function handleKey(e){e.code===\"Enter\"&&handleSend();};return/*#__PURE__*/_jsxs(\"div\",{className:\"input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type something...\",onChange:function onChange(e){return setText(e.target.value);},value:text,onKeyDown:handleKey}),/*#__PURE__*/_jsxs(\"div\",{className:\"send\",children:[/*#__PURE__*/_jsx(\"img\",{src:Attach,alt:\"\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:\"none\"},id:\"file\",onChange:function onChange(e){return setImg(e.target.files[0]);}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file\",children:/*#__PURE__*/_jsx(\"img\",{src:Img,alt:\"\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,children:\"Send\"})]})]});};export default Input;","map":{"version":3,"names":["arrayUnion","doc","serverTimestamp","updateDoc","React","useContext","useState","AuthContext","ChatContext","Img","Attach","v4","uuid","Timestamp","db","storage","getDownloadURL","ref","uploadBytesResumable","jsx","_jsx","jsxs","_jsxs","Input","_useState","_useState2","_slicedToArray","text","setText","_useState3","_useState4","img","setImg","_useContext","currentUser","_useContext2","data","handleSend","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","_updateDoc","_updateDoc2","storageRef","uploadTask","wrap","_callee2$","_context2","prev","next","on","error","snapshot","then","_ref2","_callee","downloadURL","_callee$","_context","chatId","messages","id","senderId","uid","date","now","stop","_x","apply","arguments","_defineProperty","user","handleKey","e","code","className","children","type","placeholder","onChange","target","value","onKeyDown","src","alt","style","display","files","htmlFor","onClick"],"sources":["/home/akshajkanumuri/GitHub/VS-Code-Projects/Web Development/Chat Application/src/components/Input.jsx"],"sourcesContent":["import { arrayUnion, doc, serverTimestamp, updateDoc } from \"firebase/firestore\";\nimport React, { useContext, useState } from \"react\";\nimport { AuthContext } from \"../context/AuthContext\";\nimport { ChatContext } from \"../context/ChatContext\";\nimport Img from \"./img/image.png\"\nimport Attach from \"./img/paper-clip.png\"\nimport { v4 as uuid } from \"uuid\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { db, storage } from \"../firebase\";\nimport { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\";\n\nconst Input = () => {\n    const [ text, setText] = useState(\"\");\n    const [ img, setImg] = useState(null);\n\n    const {currentUser} = useContext(AuthContext);\n    const {data} = useContext(ChatContext);\n    \n    const handleSend = async () => {\n         \n        if(img && text !== \"\"){\n            const storageRef = ref(storage, uuid());\n\n            const uploadTask = uploadBytesResumable(storageRef, img);\n\n            uploadTask.on(\n                (error) => {\n                    \n                },\n                () => {\n                    getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n                        await updateDoc(doc(db, \"chats\", data.chatId), {\n                            messages: arrayUnion({\n                                id: uuid(),\n                                text,\n                                senderId: currentUser.uid,\n                                date: Timestamp.now(),\n                                img: downloadURL\n                            }),\n                        });\n                    })\n                }\n            )\n        }\n        else if(text !== \"\"){\n            await updateDoc(doc(db, \"chats\", data.chatId), {\n                messages: arrayUnion({\n                    id: uuid(),\n                    text,\n                    senderId: currentUser.uid,\n                    date: Timestamp.now(),\n                }),\n            });\n        }\n\n        await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n            [data.chatId + \".lastMessage\"]:{\n                text\n            },\n            [data.chatId + \".date\"]:serverTimestamp()\n        });\n\n        await updateDoc(doc(db, \"userChats\", data.user.uid), {\n            [data.chatId + \".lastMessage\"]:{\n                text\n            },\n            [data.chatId + \".date\"]:serverTimestamp()\n        });\n\n        setText(\"\");\n        setImg(null);\n    };\n\n    const handleKey = (e) => {\n        e.code === \"Enter\" && handleSend();\n    }\n    \n    return (\n        <div className=\"input\">\n            <input type=\"text\" placeholder=\"Type something...\" onChange={e=>setText(e.target.value)} value={text} onKeyDown={handleKey}/>\n            <div className=\"send\">\n                <img src={Attach} alt=\"\" />\n                <input type=\"file\" style={{display:\"none\"}} id=\"file\" onChange={e=>setImg(e.target.files[0])}/>\n                <label htmlFor=\"file\">\n                    <img src={Img} alt=\"\" />\n                </label>\n                <button onClick={handleSend}>Send</button>\n            </div>\n        </div>\n    )\n}\n\nexport default Input"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}